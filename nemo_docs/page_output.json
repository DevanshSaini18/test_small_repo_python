[
  {
    "heading": "Architecture Overview",
    "text": "# Architecture Overview\n## Entry Point & Middleware\n- `main.py` bootstraps the FastAPI app, exposes `/` and `/health`, configures CORS, attaches logging middleware that injects `X-Process-Time`, and wires up global exception handling plus router inclusion under `/api/v1`.\n- Database tables are ensured by calling `Base.metadata.create_all(bind=engine)` during startup to keep the schema in sync with SQLAlchemy models.\n\n## API Routing & Access Control\n- `app/routes.py` defines grouped endpoints for auth, organizations, teams, items, comments, tags, API keys, webhooks, activity logs, and analytics, delegating to service functions while enforcing status codes and HTTP errors.\n- Dependencies from `app/dependencies.py` inject the current user/organization, enforce RBAC via `require_role`, and validate API keys, ensuring each request carries a properly scoped session and multi-tenant context.\n\n## Service & Business Logic Layer\n- `app/services.py` encapsulates CRUD operations, tagging, commenting, webhook/API-key lifecycle, activity logging, and analytics calculations with SQLAlchemy sessions.\n- Analytics cover status/priority breakdowns, overdue/completion trends, usage stats, and average response/error rates, while `log_activity`/`log_usage` keep audit trails tied to organizations and users.\n\n## Data & Persistence\n- `app/database.py` configures the SQLite engine, session factory, and request-scoped `get_db` generator consumed by FastAPI dependencies.\n- `app/models.py` defines the multi-tenant schema (organizations, users, teams, items, comments, tags, API keys/webhooks, usage/activity logs) with enums for roles, status, priority, and subscription tiers, plus association tables for teams, tags, assignees.\n\n## Security Helpers\n- `app/auth.py` supplies password hashing, JWT creation/verification, and API key generation that underpin `routes` and `dependencies` for secure access.",
    "source_files": [
      "main.py",
      "app/routes.py",
      "app/services.py",
      "app/dependencies.py",
      "app/database.py",
      "app/models.py",
      "app/auth.py"
    ]
  },
  {
    "heading": "Authentication and Authorization Services",
    "text": "# Authentication and Authorization Services\nSupports JWT-backed login/register, RBAC, and API-key verification for the multi-tenant todo platform.\n\n## Credential and token utilities\n- Passwords hashed via passlib bcrypt; tokens minted with jose, HS256, a 24\u2011hour expiry (`ACCESS_TOKEN_EXPIRE_MINUTES`), and a `sub` claim; `decode_access_token` returns the payload or `None` so guards can react to invalid/expired tokens.\n- API keys generated as `sk_{...}` secrets via `generate_api_key` for service-to-service access and stored with expiration metadata.\n\n## FastAPI authentication endpoints\n| Endpoint | Description | Guard & Schemas |\n| --- | --- | --- |\n| `POST /auth/register` | Validates unique email and organization, hashes the password in `create_user`, logs activity, and returns `UserRead`. | `UserCreate` \u279c `UserRead`, no auth but requires an existing organization. |\n| `POST /auth/login` | Verifies credentials with `verify_password`, ensures the user is active, and issues the JWT `Token`. | `UserLogin` \u279c `Token`, open endpoint. |\n| `GET /auth/me` | Returns the current authenticated user profile. | Guarded by `get_current_active_user`, responds with `UserRead`. |\n\n## Authorization dependencies\n- `get_current_user` uses `HTTPBearer`, decodes the JWT, looks up the `User`, enforces `is_active`, updates `last_login`, and keeps the organization in scope.\n- `get_current_active_user` and `get_current_organization` ensure actions occur within an active tenant before business logic runs.\n- `require_role` compares the `UserRole` hierarchy (`viewer < member < admin < owner`) to gate Admin/Owner APIs.\n- `verify_api_key` reads `X-Api-Key`, confirms the key row is active/unexpired, updates `last_used_at`, and returns the owning `Organization` so API-key calls map to the right tenant.\n\n## API key lifecycle\n- `create_api_key` (service + `APIKeyCreate`/`APIKeyRead`) pairs generated secrets with organization, optional expiration, and audit timestamps; `get_api_keys` lists them for Admin users.\n- The `APIKey` model stores `is_active`, `expires_at`, and `last_used_at`; the verification dependency enforces those flags before surfacing the organization to downstream routes.\n",
    "source_files": [
      "app/auth.py",
      "app/routes.py",
      "app/dependencies.py",
      "app/services.py",
      "app/schemas.py",
      "app/models.py"
    ]
  },
  {
    "heading": "API Overview and Schemas",
    "text": "# API Overview and Schemas\n\n## API Surface\n- **Base URL:** `http://localhost:8000/api/v1` and `/docs` for interactive Swagger UI.\n- **Authentication:** `/auth/register`, `/auth/login`, `/auth/me`; all other endpoints require either a bearer JWT or `X-API-Key`. Admin-only routes use role enforcement (`require_role(UserRole.ADMIN)`).\n- **Rate limiting:** tiered (Free: 100/min, Starter: 500/min, Professional: 2k/min, Enterprise: unlimited).\n\n## Endpoint Groups\n| Area | Key Routes | Notes |\n| --- | --- | --- |\n| Authentication | `/auth/register`, `/auth/login`, `/auth/me` | Creates/logs in users, returns JWT token payloads from `Token` schema. |\n| Organizations | `/organizations`, `/organizations/current`, `/organizations/{id}/users` | Multi-tenant onboarding plus listing org users.\n| Teams | `/teams`, `/teams/{team_id}/members/{user_id}` | Admin-only creation and membership management.\n| Items | `/items`, `/items/{id}`, filters via query params (`team_id`, `status`, `priority`, `assigned_to`, `skip`, `limit`), update/delete APIs | CRUD plus filtering/pagination with RBAC via dependencies.\n| Comments/Tags | `/comments`, `/items/{id}/comments`, `/tags` | Item-scoped comment creation and global tag management.\n| API Keys & Webhooks | `/api-keys`, `/webhooks` | Admin-only key/webhook lifecycle plus event delivery documentation (HMAC-SHA256 signature).\n| Activity & Analytics | `/activity`, `/analytics/items`, `/analytics/usage` | Logs and aggregated metrics (item status/priority breakdown, usage stats).\n\n## Schema Coverage\n- **Organizations:** `OrganizationBase`, `Create`, `Update`, `Read` expose subscription tiers, quotas, activation flags.\n- **Users:** `UserBase`, `Create`, `Update`, `Read`, `Login`, plus `Token` for auth flows.\n- **Teams/Tags/Items:** CRUD DTOs with nested relations (`ItemRead` surfaces assignees, tags, audit timestamps).\n- **Comments/Attachments/Activity:** read/write schemas capture item linkage, authorship, metadata.\n- **API Keys/Webhooks/Analytics:** DTOs describe key metadata, webhook payload/secrets, and analytics summaries (`ItemAnalytics`, `UsageAnalytics`).\n\nEach route tightly maps to these Pydantic models (`app/routes.py`) and is documented in `docs/api-reference.md` for payload samples, filters, and error responses.",
    "source_files": [
      "docs/api-reference.md",
      "app/routes.py",
      "app/schemas.py"
    ]
  },
  {
    "heading": "Deployment and Infrastructure",
    "text": "# Deployment and Infrastructure\n## Container image & runtime\n- Base image is `python:3.11-slim`; installs GCC and PostgreSQL client, installs dependencies via Poetry (falls back to `requirements.txt`), copies source, creates `uploads/`, exposes port 8000, and defines a health check against `/health` before launching `uvicorn main:app`. (Dockerfile)\n\n## Compose deployment stack\n- `docker-compose.yml` orchestrates three services: a Postgres 15 Alpine database with persistent `postgres_data` volume and `pg_isready` health check; the app build that injects `DATABASE_URL`, `SECRET_KEY`, `CORS_ORIGINS`, `DEBUG`, mounts `uploads`, waits for the healthy DB, and restarts unless stopped; and an Nginx reverse proxy that exposes 80/443, mounts the local `nginx.conf`/`ssl` directories, and depends on the app. (docker-compose.yml)\n\n## Environment & secrets\n- `.env.example` documents runtime configuration: database string (SQLite default vs. PostgreSQL), secret key guidance, JWT algorithm/expiry, CORS origins, app metadata, debug flag, rate limits, optional SMTP entries, webhook timeouts/retries, upload constraints, and logging level/file\u2014serving as the reference for production overrides. (.env.example)\n\n## Production deployment & operations\n- `docs/deployment.md` consolidates infrastructure advice: Docker image/Compose commands, AWS Elastic Beanstalk/ECS and DigitalOcean App Platform flows, certbot/Nginx TLS snippets, Sentry integration, log aggregation targets, Alembic migrations, health-check payload, horizontal/vertical scaling tactics, Redis caching, backup scripts (Postgres dump + uploads/configs), and ongoing monitoring/security/maintenance checklists. (docs/deployment.md)",
    "source_files": [
      "Dockerfile",
      "docker-compose.yml",
      ".env.example",
      "docs/deployment.md"
    ]
  },
  {
    "heading": "Database Models and Services",
    "text": "# Database Models & Services\n\n## Models overview\n- **Enums & associations**: `PriorityLevel`, `ItemStatus`, `UserRole`, `SubscriptionTier` drive status/role constraints; many-to-many join tables (`user_teams`, `item_tags`, `item_assignees`) manage memberships and assignments.\n- **Organization**: multi-tenant root with subscription caps, relationships to `User`, `Team`, `Item`, `APIKey`, `Webhook`, `UsageLog`, `UsageLog` and audit trails.\n- **User/Team**: RBAC enabled via `User.role`, team membership via `user_teams`, creator/assignee links to items, activity logging, comments, attachments.\n- **Item/Comment/Attachment**: Items support priority, status, subtasks, due/completion timestamps, tags, assignees, comments, attachments, activity logs; comments/attachments cascade on deletion.\n- **Support models**: `Tag`, `APIKey`, `Webhook`, `UsageLog`, `ActivityLog` capture metadata, integrations, usage telemetry.\n\n| Model | Key responsibilities |\n| --- | --- |\n| `Item` | Status/priority tracking, team/linking, subtasks, assignment, tagging, completion metadata |\n| `APIKey` & `Webhook` | External integrations scoped to orgs, lifecycle and secret storage |\n| `UsageLog` & `ActivityLog` | Observability: request metrics, user actions, entity changes |\n\n## Service Layer\n- **Organization/User/Team CRUD**: creation helpers ensure password hashing, activity logging, and membership management; team join adds users via secondary table.\n- **Item lifecycle**: `create_item`, `update_item`, `delete_item` manage assignees/tags, enforce org scoping, auto-complete timestamps, and persist audit entries with change diffs.\n- **Comments/Tags/API keys/Webhooks**: existence checks, scoped retrieval, and creation helper routines tied to organization context.\n- **Observability & analytics**: `log_activity` centralizes audits; `get_activity_logs` filters by org/item; `get_item_analytics` aggregates counts by status/priority, overdue/completion metrics, avg completion time; `log_usage`/`get_usage_analytics` capture endpoint usage, average response, error rates.\n",
    "source_files": [
      "app/models.py",
      "app/services.py"
    ]
  },
  {
    "heading": "Getting Started Guide",
    "text": "# Getting Started Guide\n\nQuick path to running the FastAPI Todo SaaS stack locally and exercising its APIs.\n\n## Local Setup\n- **Prerequisites:** Python 3.11+, Poetry (or pip), Docker (optional), Git.\n- **Clone:** `git clone https://github.com/your-org/fastapi-todo-saas.git && cd fastapi-todo-saas`.\n- **Dependencies:** `poetry install && poetry shell` (or `pip install -r requirements.txt`).\n- **PostgreSQL:** Run via Docker with `postgres:15`, then `alembic upgrade head` to apply migrations.\n- **Run server:** `uvicorn main:app --reload`, API exposed at `http://localhost:8000`.\n\n## Authentication Flow\n- Register user via `/auth/register` POST with email, username, password, org.\n- Log in via `/auth/login`, storing returned JWT (`access_token`).\n- Attach bearer token (`Authorization: Bearer <token>`) to protected requests or use `X-API-Key` (admin-generated).\n\n## First API Call\n- POST `/items` with metadata (title, status, priority, due date, team, assignees, tags) to create work items.\n\n## Next Steps\n- Browse the full API surface in the **API Reference** (`docs/api-reference.md`).\n- Generate API keys for service-to-service integrations and consult architecture materials for deeper context.\n",
    "source_files": [
      "docs/getting-started.md",
      "docs/api-reference.md"
    ]
  },
  {
    "heading": "Feature Comparison and Roadmap",
    "text": "# Feature Comparison and Roadmap\n\n## Transformation Snapshot\n- Evolves a basic in-memory todo list into a production-ready, multi-tenant SaaS platform with JWT/API key authentication, RBAC, organizations, teams, comments, tags, analytics, and webhooks.\n- Items gain structured metadata (status, priority, due dates, time tracking, relationships, attachments) while audit/logging models capture history and usage.\n\n## Feature Expansion Highlights\n| Feature | Before | After |\n|---|---|---|\n| Storage | In-memory list | SQLAlchemy + PostgreSQL/SQLite |\n| Auth/Z roles | \u274c | JWT + API keys + RBAC |\n| Collaboration | \u274c | Teams, comments, assignments |\n| Observability | \u274c | Activity logs, analytics, health checks |\n| Integrations | \u274c | Webhooks, API keys |\n| Deployment | Manual uvicorn | Docker, Compose, Nginx, health probes |\n\n## API and Integration Growth\n- Expands from 5 endpoints to 30+, covering auth, orgs, teams, items (filters, tags, subtasks), comments, tags, API keys, webhooks, activity logs, analytics, health, and info routes.\n\n## Monetization & Roadmap\n- Subscription tiers (Free \u2192 Starter \u2192 Professional \u2192 Enterprise) unlock seat/item limits and premium perks.\n- Growth levers: freemium conversion, seat expansion, tier upgrades, add-ons (webhooks, analytics), API usage upsells; goal: 10K customers \u00d7 $83/mo \u2248 $10M ARR.\n\n## Deployment & Documentation\n- Production-ready stack: Docker/Docker Compose, PostgreSQL, Nginx reverse proxy, env configs, SSL readiness, structured logging, request logging, CORS, rate limiting groundwork.\n- Documentation suite: comprehensive README, API reference, deployment guide, feature docs, OpenAPI/Swagger, ReDoc, env template.\n\n## Metrics & Outlook\n- ~12 database tables, 30+ endpoints, authentication, analytics, RBAC, enterprise SLAs, usage tracking, and audit logs justify premium pricing and roadmap continuity.",
    "source_files": [
      "docs/feature-comparison.md"
    ]
  }
]